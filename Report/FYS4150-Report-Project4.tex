\documentclass{article}

\usepackage[margin=0.5in,bottom=1in,footnotesep=1in]{geometry}

\usepackage{amsmath}


\usepackage{multicol}
\setlength{\columnsep}{1cm}
\usepackage[]{algorithm2e}

\usepackage{lipsum}% for dummy text
\usepackage[varg]{txfonts}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{multirow}

\usepackage[font=small,labelfont={sf,bf}]{caption}

\usepackage{color}

\usepackage[export]{adjustbox}

\usepackage{titlesec}
\titleformat{\section}{\fontfamily{phv}\fontsize{12}{15}\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\fontfamily{phv}\fontsize{10}{15}\itshape}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\fontfamily{phv}\fontsize{9}{15}\bfseries}{\thesubsubsection}{1em}{}


\title{\textbf{FYS4150 Project 4: \\The Ising model in two dimensions}}
\author{Marie Foss (\# 56), Maria Hammerstr{{\o}}m (\# 59)}
\date{}

\begin{document}

\maketitle

\begin{abstract}
	\noindent \lipsum[1]
	\vspace*{2ex}
	
	\noindent \textbf{Github:} \textit{https://github.com/mariahammerstrom/Project4}
	\vspace*{2ex}
\end{abstract}



\begin{multicols}{2}

\section{Introduction}

The Ising model is a model to study phase transitions at finite temperature for magnetic systems. The model was invented in 1920\footnote{Lenz, W. (1920). "Beiträge zum Verständnis der magnetischen Eigenschaften in festen Körpern". \textit{Physikalische Zeitschrift} 21: 613-615.} and the analytical solution to the two-dimensional case was found in 1944\footnote{Onsager, Lars (1944). "Crystal statistics. I. A two-dimensional model with an order-disorder transition". \textit{Physical Review}, Series II 65 (3-4): 117-149.}. This project deals with the Ising model in two dimensions without an external magnetic field. 




\subsection{Theory}\label{subsec:theory}
In the two-dimensional Ising model, the simplest form of the \textbf{energy} for a specific microstate $i$ is expressed as

\begin{equation}\label{eq:energy}
	E_i = -J \sum_{\langle kl\rangle}^{N}s_k s_l,
\end{equation}
with  $s_k=\pm 1$ where $+ 1$ denotes spin up and $ - 1$ denotes spin down, $N$ is the total number of spins and $J$ is a coupling constant expressing the strength of the interaction between neighboring spins. The symbol $\langle kl\rangle$ indicates that the sum is over nearest neighbors only. We assume ferromagnetic ordering, meaning $J> 0$ and will make use of periodic boundary conditions.

The probability of finding the system in a given microstate $i$ is expressed by the \textbf{Boltzmann probability distribution}

\begin{equation}
	P_i (\beta) = \frac{e^{-\beta E_i}}{Z},
\end{equation}
where $\beta = 1/kT$ with $k$ the Boltzmann constant and $T$ the temperature, and with $Z$ as the \textbf{partition function} for the canonical ensemble defined as

\begin{equation}\label{eq:partition_func}
	Z = \sum_{i = 1}^{\infty} e^{-\beta E_i},
\end{equation}
summing over all micro states $i$. 

The \textbf{magnetic moment} of a given microstate is

\begin{equation}\label{eq:magnetization}
	{\cal M}_i = \sum_j s_j.
\end{equation} 
Some quantities of interest are the \textbf{expection values} for the energy $\langle E\rangle$ and magnetic moment $\langle {\cal M}\rangle$:

\begin{equation}
\begin{aligned}
	\langle E \rangle &= \frac{1}{Z} \sum_i E_i e^{- \beta E_i} = kT^2 \frac{\partial \textrm{ ln } Z}{\partial T} = - \frac{\partial \textrm{ ln } Z}{\partial \beta} \\
	\langle {\cal M}\rangle &= \frac{1}{Z} \sum_i {\cal M}_i e^{- \beta E_i},
\end{aligned}
\end{equation}
as well as the \textbf{variances} for the energy $\sigma_E^2$ and for the magnetic moment $\sigma_M^2$, describing how the calculated values of $E$ and $M$ deviates from the expectation values:

\begin{equation}\label{eq:expect_values}
\begin{aligned}
	\sigma_E^2 &= \langle E^2\rangle - \langle E\rangle^2 \\
	\sigma_{\cal M}^2 &= \langle {\cal M}^2\rangle - \langle {\cal M}\rangle^2,
\end{aligned}
\end{equation}
These values can be used to calculate the \textbf{heat capacity} of a fixed volume given by

\begin{equation}
	C_V = \frac{\sigma_E^2}{kT^2} = \frac{\partial \langle E\rangle}{\partial T},
\end{equation}
and the \textbf{susceptibility}, which describes whether a material is attracted into or repelled out of a magnetic field, given by

\begin{equation}
	\chi = \frac{\sigma_{\cal M}^2}{kT} = \frac{\langle {\cal M}^2\rangle - \langle {\cal M}\rangle^2}{kT}.
\end{equation}
We want to compute these quantities after the system has \textbf{thermalized}, which is when the system has reached its most likely state. The most likely state depends on the temperature $T$.

The model we are considering here undergoes a \textbf{phase transition}. Below a critical temperature $T_C$ there is spontaneous magnetization $\langle {\cal M}\rangle \neq 0$ (magnetic phase), while above this temperature the average magnetization is zero (paramagnetic phase). Near $T_C$ we can characterize the behavior of many physical quantities by a power law behavior.

An important quantity is the \textbf{correlation length}, which is expected to be of the order of the lattice spacing for $T \gg T_C$. Because the spins become more and more correlated as $T$ approaches $T_C$, the correlation length increases as we get closer to the critical temperature. The divergent behavior of $\xi$ near $T_C$ is

\begin{equation}\label{eq:xi}
	\xi(T) \sim \left|T_C-T\right|^{-\nu}.
\end{equation}
A second-order phase transition is characterized by a correlation length which spans the whole system. Since we are always limited to a finite lattice, $\xi$ will be proportional with the size of the lattice. Through so-called finite size scaling relations it is possible to relate the behavior at finite lattices with the results for an infinitely large lattice. The critical temperature then scales as

\begin{equation}\label{eq:T_C}
	T_C(L)-T_C(L=\infty) = aL^{-1/\nu},
\end{equation}
with $a$ a constant and  $\nu$ defined in Eq.~(\ref{eq:xi}).




\subsection{Analytical solution}\label{subsec:analytical}
First we will assume that we only have two spins in each dimension, that is $L = 2$, where $L$ is the lattice length. The situation looks like this:

\begin{equation*}
\begin{aligned}
	\uparrow_{(1)} \quad \uparrow_{(2)}   \\
	\uparrow_{(3)} \quad \uparrow_{(4)}   
\end{aligned}
\end{equation*}
where an upward arrow denotes spin up. We will make use of \textbf{periodic boundary conditions}, which means that the neighbor to the right of a given spin $s_N$ takes the value of $s_1$. Similarly, the neighbor to the left of $s_1$ takes the value of $s_N$. This way of treating the boundaries are often used when approximating an infinite system that has a repeating structure. In our case, this mean we will treat our system as though it looked like this (where the original system is highlighted in magenta):

\begin{equation*}
\begin{aligned}
	\textcolor{black}{\uparrow_{(4)}} \quad \textcolor{black}{\uparrow_{(3)}} \quad \textcolor{black}{\uparrow_{(4)}} \quad \textcolor{black}{\uparrow_{(3)}} \\
	\textcolor{black}{\uparrow_{(2)}} \quad \textcolor{magenta}{\uparrow_{(1)}} \quad \textcolor{magenta}{\uparrow_{(2)}} \quad \textcolor{black}{\uparrow_{(1)}} \\
	\textcolor{black}{\uparrow_{(4)}} \quad \textcolor{magenta}{\uparrow_{(3)}} \quad \textcolor{magenta}{\uparrow_{(4)}} \quad \textcolor{black}{\uparrow_{(3)}} \\
	\textcolor{black}{\uparrow_{(2)}} \quad \textcolor{black}{\uparrow_{(1)}} \quad \textcolor{black}{\uparrow_{(2)}} \quad \textcolor{black}{\uparrow_{(1)}}
\end{aligned}
\end{equation*}
Closed form expression can be found for the partition function in Eq. (\ref{eq:partition_func}) and the corresponding expectation values for $E$, $|{\cal M}|$, the specific heat $C_V$ and the susceptibility $\chi$ as functions of $T$ using periodic boundary conditions. In the case $L = 2$ we can write Eq. (\ref{eq:energy}) for the different components as, making use of the periodic boundary conditions, giving

\begin{equation*}
\begin{aligned}
	E_1 &= - J (s_1 s_2 + s_1 s_3) = - 2J, \\
	E_2 &= - J (s_1 s_2 + s_2 s_4) = - 2J, \\
	E_3 &= - J (s_1 s_3 + s_3 s_4) = - 2J, \\
	E_4 &= - J (s_3 s_4 + s_2 s_4) = - 2J. 
\end{aligned}
\end{equation*}
Thus the total energy for the system is

\begin{equation*}
	E = E_1 + E_2 + E_3 + E_4 = - 8J.
\end{equation*}
If going through this exercise for different configurations of spin up and spin down, we find values for energies, degeneracies and magnetization for different configurations as shown in Table~\ref{table:quantities}, where magnetization is calculated from Eq. (\ref{eq:magnetization}).

\begin{table*}
\begin{center}
\begin{tabular}{ l r r r }\hline
	Number of spins up 			& Energy $E$	 			& Degeneracy $\Omega$		& Magnetization ${\cal M}$		\\ \hline
	4 						& $- 8J$ 					& 1						& 4		 \\
	3 						& 0						& 4						& 2		 \\
	2						& 0						& 4						& 0		\\
	2						& $8J$					& 2						& 0		\\
	1						& 0						& 4						& -2		\\
	0						& $-8J$					& 1						& -4		\\
	\hline
\end{tabular}
\caption{Energy and magnetization for the two-dimensional Ising model with $N = 2 \times 2$ spins with periodic boundary conditions.}\label{table:quantities}
\end{center}
\end{table*}

These calculations can be used to find the closed-form expressions, starting with the partition function, which can be expressed as

\begin{equation}\label{eq:Z_analytic}
\begin{aligned}
	Z(\beta) 	&= \sum_E \Omega(E) e^{- \beta E} = 2 e^{8J\beta} + 2 e^{- 8J \beta} + 12 \\
			&= 4 \textrm{ cosh}(8J \beta) + 12.
\end{aligned}
\end{equation}
Then the expectation value can be written, using the expression in Eq. (\ref{eq:expect_values}), as

\begin{equation}\label{eq:E_avg_analytic}
	\langle E\rangle = - \frac{8J \textrm{ sinh}(8J \beta)}{\textrm{cosh}(8J\beta) + 3} \approx - 8J \textrm{ tanh} (8J\beta),
\end{equation}
where we have used that cosh$(8J\beta) \gg 3$ in the approximation. Using this approximation gives

\begin{equation}\label{eq:C_V_analytic}
	C_V(\beta) = k \textrm{ } \bigg( \frac{8J\beta}{\textrm{cosh }(8J\beta)} \bigg)^2.
\end{equation}
Similarly, using the values for magnetization in Table~\ref{table:quantities} and Eq. (\ref{eq:magnetization}), gives

\begin{equation}\label{eq:M_avg_analytic}
\begin{aligned}
	\langle|{\cal M}|\rangle 	&= \frac{1}{Z} \bigg( 4e^{8J\beta} + 4\cdot2 + 4\cdot|-2| + |-4|e^{8J\beta} \bigg) \\
					&= \frac{8}{Z}(e^{8J\beta} + 2), \\
\end{aligned}
\end{equation}
and

\begin{equation}
\begin{aligned}
	\langle {\cal M}\rangle 	&= \frac{1}{Z} \bigg( 4e^{8J\beta} + 4\cdot2 - 4\cdot2 - 4e^{8J\beta} \bigg) = 0, \\
	%\langle M\rangle^2 	&= 0 \\
	\langle {\cal M}^2\rangle 	&= \frac{1}{Z} \bigg( 4^2 e^{8J\beta} + 4\cdot2^2 + 4\cdot(-2)^2 + (-4)^2e^{8J\beta}   \bigg) \\
			&= \frac{32}{Z} \bigg( e^{8J\beta} + 1  \bigg).
\end{aligned}
\end{equation}
Thus

\begin{equation}\label{eq:chi_analytic}
	\chi(\beta) = \frac{\langle {\cal M}^2\rangle - \langle {\cal M}\rangle^2}{kT} = \frac{32\beta}{Z} [e^{8J\beta} + 1] - \frac{\beta}{Z^2}[8e^{8J\beta} + 4]^2
	% \frac{32 \beta}{Z} \bigg(e^{8J\beta} + 1  \bigg).
\end{equation}









\section{Methods}

We wrote a code for the Ising model which computes the mean energy $E$, mean magnetization $|{\cal M}|$, the specific heat $C_V$ and the susceptibility $\chi$ as functions of  $T$ using periodic boundary conditions for in the $x$ and $y$ directions. Using the Ising model in two dimensions, the number of configurations is given by $2^N$ with $N = L \times L$ number of spins for a lattice of length $L$. 

\subsection{Algorithm}
We will use the \textbf{Metropolis algorithm}. The algorithm goes as follows:

\begin{enumerate}
	\item Generate a random configuration in the lattice to create an initial state with energy $E_b$.
	\item Change the initial configuration by flipping for example one spin only. Compute the energy of this state $E_t$.
	\item Calculate $\Delta E = E_t - E_b$ ($t$ = trial state, $b$ = beginning state).
	\item \textit{The Metropolis test:} If $\Delta E \leq 0$ the new configuration is accepted, meaning the energy is lowered and we are moving towards the energy minimum at a given temperature. If $\Delta E > 0$, calculate $w = e^{- \beta \Delta E}$. If $w < r$ where $r$ is a random number, accept the new configuration. If else, keep the old configuration.
	\item Compute the new energy $E' = E_t + \Delta E$. Calculate various expectation values using this energy.
	\item Repeat steps $2-5$ for the chosen number of Monte Carlo cycles, meaning the number of times we should sweep through the lattice and summed over all spins.
	\item Compute the various expectation values by dividing by the total number of cycles (and possibly the number of spins).
\end{enumerate}
During the computation we want to check how many Monte Carlo cycles we need before the system has reached its most likely state. This is done by comparing the new value of $\langle E \rangle$ with the previous value of $\langle E \rangle$. If the difference is smaller than $5 \%$, we can say that the most likely state has been reached.

After the most likely state has been reached, we want to 


\subsection{Parallelization}
We have parallelized our code using the Open MPI library. ADD DETAILS.





\section{Results}

Computing the mean energy $E$, mean magnetization $|{\cal M}|$, the specific heat $C_V$ and the susceptibility $\chi$ with periodic boundary conditions numerically using the expressions from Sec.~\ref{subsec:theory} can be compared with the results using the analytical closed form expressions given in Sec.~\ref{subsec:analytical}. For temperature $T=1.0$ (in units of $kT/J$), this gives the following results for a $2 \times 2$ spin system where the initial state has all spins pointing upwards:

\begin{center}
\begin{tabular}{ l l l }\hline
	Quantity 								& Closed form	 				& Numerical		\\ \hline
	Mean energy $E$ 						& $-8.00$ 						& -		 \\
	Mean magnetization $|{\cal M}|$ 			& 3.99						& -		 \\
	Specific heat $C_V$						& $2.88 \times 10^{-5}$			& - 		\\
	Susceptibility $\chi$						& $8.02 \times 10^{-3}$			& -		\\
	\hline
\end{tabular}
\end{center}
The numerical results follow that of Table \ref{table:quantities}. The result from the closed form expressions are not as good. COMMENT. The minimum number of Monte Carlo cycles needed to achieve good agreement for the expectation value for energy is calculated to be 22-24 cycles, which will vary slightly for each run.

Next we looked at the case of $L = 20$ spins in the $x$ and $y$ directions. In this case we wanted to perform a study of the time (or number of Monte Carlo cycles) we need before reaching an equilibrium situation and can start computing the various expectation values. A rough study is done by plotting the various expectation values as a function of number of Monte Carlo cycles, for both $T = 1.0$ kT/J and T = $2.4$ kT/J, as shown in Fig. XXX. PLOT + COMMENTS!

\begin{figure*}[t]
\begin{center}
\begin{tabular}{ccc}
  	\includegraphics[width=85mm]{images/exp_values_EM_vs_MC_cycles_20x20_T10.png}
	& \includegraphics[width=85mm]{images/exp_values_CX_vs_MC_cycles_20x20_T10.png} \\
	(a) $T = 1.0$					& (b) $T = 1.0$  \\
	
	 \includegraphics[width=85mm]{images/exp_values_EM_vs_MC_cycles_20x20_T24.png}
	& \includegraphics[width=85mm]{images/exp_values_CX_vs_MC_cycles_20x20_T24.png} \\
	(c) $T = 2.4$					& (d) $T = 2.4$  \\[6pt]
\end{tabular}
\caption{Expectation values as a function of number of Monte Carlo cycles.}\label{fig:L20_ex_values}
\end{center}
\end{figure*}
We also study the total number of accepted configurations as a function of the total number of Monte Carlo cycles, shown in Fig.~\ref{fig:L20_accepted_configs_MC}. PLOT + COMMENTS! 

\begin{figure*}[t]
\begin{center}
\begin{tabular}{ccc}
  	\includegraphics[width=85mm]{images/accept_configs_MC_20x20_T10.png}
	& \includegraphics[width=85mm]{images/accept_configs_MC_20x20_T24.png} \\
	(a) $T = 1.0$					& (b) $T = 2.4$  \\[6pt]
\end{tabular}
\caption{Number of accepted configurations as a function of the total number of Monte Carlo cycles.}\label{fig:L20_accepted_configs_MC}
\end{center}
\end{figure*}
How does the total number of accepted configurations vary as a function of temperature? This is shown in Fig.~\ref{fig:L20_accepted_configs_temp}. COMMENT.

\begin{center}
	\includegraphics[width=80mm]{images/accept_configs_T_20x20.png} 	
	\captionof{figure}{Number of accepted configurations as a function of temperature.}
	\label{fig:L20_accepted_configs_temp}
\end{center}

%\begin{figure*}
%\begin{center}
%  	\includegraphics[width=120mm]{images/accept_configs_T_20x20.png} \\
%\caption{Number of accepted configurations as a function of temperature.}\label{fig:L20_accepted_configs_temp}
%\end{center}
%\end{figure*}

...

By simply counting the number of times a given energy appears in our computation we can compute the probability $P_i$. We start the counting after the steady state situation has been reached. This result is compared with the compute variance in energy $\sigma_E^2$. DISCUSS. 

In our study of the behavior of our model close to the critical temperature we look at the various expectation values as a function of $T$ for $L = 20, L = 40, L = 60$ and $L = 80$ for $T \in [2.0,2.4]$.

The spin matrix for $L = 80$ in this temperature range is visualized in Fig.~\ref{fig:visualization}, where white squares represent upward spins and black squares represent downward spins. It shows clearly that the net magnetization $\langle {\cal M}\rangle$ is higher for low $T$ with most spins pointing in the same direction (in this case upwards), while the $\langle {\cal M}\rangle$ approaches zero at higher $T$ where the number of spins pointing upward and downward are about the same.

\begin{figure*}[t]
\begin{center}
\begin{tabular}{ccc}
  	\includegraphics[width=56mm,frame]{images/visualization_L80_T2_0_square.png}
	& \includegraphics[width=56mm,frame]{images/visualization_L80_T2_2_square.png}
	& \includegraphics[width=56mm,frame]{images/visualization_L80_T2_4_square.png} \\
	
	(a) $T = 2.0$					
	& (b) $T = 2.2$
	& (c) $T = 2.4$  \\[6pt]
\end{tabular}
\caption{Visualization of the spin matrix for a $80 \times 80$ lattice for different temperatures $T$. White = spin up, black = spin down.}\label{fig:visualization}
\end{center}
\end{figure*}
.... MORE.

Lastly, we want to estimate the critical temperature $T_C$ in the thermodynamical limit $L \rightarrow \infty$ running simulations for different values of $L$ using Eq. (\ref{eq:T_C}). 


\section{Conclusions}

...





\section{List of codes}

The codes developed and used for this project are:\\

\noindent \verb@main.cpp@ -- main program (C++).

\noindent \verb@plotting.py@ -- plotting program which makes plots to study the total number of accepted configurations as a function of total number of Monte Carlo cycles and as a function of temperature $T$ (Python).

\noindent \verb@visualization.py@ -- provided program for running the Metropolis algorithm and plotting the spin matrix, as shown in Fig.~\ref{fig:visualization} (Python).

\end{multicols}

\end{document}
